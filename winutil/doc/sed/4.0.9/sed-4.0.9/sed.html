<html lang="en">
<head>
<title>sed, a stream editor</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="sed, a stream editor">
<meta name="generator" content="makeinfo 4.6">
<!--
This file documents version 4.0.9 of
<small>GNU</small> <code>sed</code>, a stream editor.

   <p>Copyright &copy; 1998, 1999, 2001, 2002, 2003, 2004 Free
Software Foundation, Inc.

   <p>This document is released under the terms of the GNU Free Documentation
License as published by the Free Software Foundation; either version 1.1, or
(at your option) any later version.

   <p>You should have received a copy of the GNU Free Documentation License along
with <small>GNU</small> <code>sed</code>; see the file <code>COPYING.DOC</code>.  If not, write to the Free
Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.

   <p>There are no Cover Texts and no Invariant Sections; this text, along
with its equivalent in the printed manual, constitutes the Title Page.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
--></style>
</head>
<body>
<h1 class="settitle">sed, a stream editor</h1>
<div class="node">
<p><hr>
Node:&nbsp;<a name="Top">Top</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>
<br>
</div>

<h2 class="unnumbered"></h2>

<ul class="menu">
<li><a accesskey="1" href="#Introduction">Introduction</a>:                Introduction
<li><a accesskey="2" href="#Invoking%20sed">Invoking sed</a>:                Invocation
<li><a accesskey="3" href="#sed%20Programs">sed Programs</a>:                <code>sed</code> programs
<li><a accesskey="4" href="#Examples">Examples</a>:                    Some sample scripts
<li><a accesskey="5" href="#Limitations">Limitations</a>:                 Limitations and (non-)limitations of <small>GNU</small> <code>sed</code>
<li><a accesskey="6" href="#Other%20Resources">Other Resources</a>:             Other resources for learning about <code>sed</code>
<li><a accesskey="7" href="#Reporting%20Bugs">Reporting Bugs</a>:              Reporting bugs

<p>
</p><li><a accesskey="8" href="#Extended%20regexps">Extended regexps</a>:            <code>egrep</code>-style regular expressions

<p>
</p><li><a accesskey="9" href="#Concept%20Index">Concept Index</a>:               A menu with all the topics in this manual. 
<li><a href="#Command%20and%20Option%20Index">Command and Option Index</a>:    A menu with all <code>sed</code> commands and
                               command-line options.

<p>--- The detailed node listing ---

<p>sed Programs:
</p><li><a href="#Addresses">Addresses</a>:                        Selecting lines with <code>sed</code>
<li><a href="#Regular%20Expressions">Regular Expressions</a>:              Overview of regular expression syntax
<li><a href="#Data%20Spaces">Data Spaces</a>:                      Where <code>sed</code> buffers data
<li><a href="#Common%20Commands">Common Commands</a>:                  Often used commands
<li><a href="#The%20%22s%22%20Command">The "s" Command</a>:                  <code>sed</code>'s Swiss Army Knife
<li><a href="#Other%20Commands">Other Commands</a>:                   Less frequently used commands
<li><a href="#Programming%20Commands">Programming Commands</a>:             Commands for <code>sed</code> gurus
<li><a href="#Extended%20Commands">Extended Commands</a>:                Commands specific of <small>GNU</small> <code>sed</code>
<li><a href="#Escapes">Escapes</a>:                          Specifying special characters

<p>Examples:
</p><li><a href="#Centering%20lines">Centering lines</a>: 
<li><a href="#Increment%20a%20number">Increment a number</a>: 
<li><a href="#Rename%20files%20to%20lower%20case">Rename files to lower case</a>: 
<li><a href="#Print%20bash%20environment">Print bash environment</a>: 
<li><a href="#Reverse%20chars%20of%20lines">Reverse chars of lines</a>: 
<li><a href="#tac">tac</a>:                              Reverse lines of files
<li><a href="#cat%20-n">cat -n</a>:                           Numbering lines
<li><a href="#cat%20-b">cat -b</a>:                           Numbering non-blank lines
<li><a href="#wc%20-c">wc -c</a>:                            Counting chars
<li><a href="#wc%20-w">wc -w</a>:                            Counting words
<li><a href="#wc%20-l">wc -l</a>:                            Counting lines
<li><a href="#head">head</a>:                             Printing the first lines
<li><a href="#tail">tail</a>:                             Printing the last lines
<li><a href="#uniq">uniq</a>:                             Make duplicate lines unique
<li><a href="#uniq%20-d">uniq -d</a>:                          Print duplicated lines of input
<li><a href="#uniq%20-u">uniq -u</a>:                          Remove all duplicated lines
<li><a href="#cat%20-s">cat -s</a>:                           Squeezing blank lines

</ul>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Introduction">Introduction</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Invoking%20sed">Invoking sed</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="chapter">1 Introduction</h2>

<p><code>sed</code> is a stream editor. 
A stream editor is used to perform basic text
transformations on an input stream
(a file or input from a pipeline). 
While in some ways similar to an editor which
permits scripted edits (such as <code>ed</code>),
<code>sed</code> works by making only one pass over the
input(s), and is consequently more efficient. 
But it is <code>sed</code>'s ability to filter text in a pipeline
which particularly distinguishes it from other types of
editors.

<div class="node">
<p><hr>
Node:&nbsp;<a name="Invoking%20sed">Invoking sed</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#sed%20Programs">sed Programs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="chapter">2 Invocation</h2>

<p><code>sed</code> may be invoked with the following command-line options:

     <dl>
<dt><code>-V</code>
     <dd><dt><code>--version</code>
     <dd>Print out the version of <code>sed</code> that is being run and a copyright notice,
then exit.

     <br><dt><code>-h</code>
     <dd><dt><code>--help</code>
     <dd>Print a usage message briefly summarizing these command-line options
and the bug-reporting address,
then exit.

     <br><dt><code>-n</code>
     <dd><dt><code>--quiet</code>
     <dd><dt><code>--silent</code>
     <dd>By default, <code>sed</code> prints out the pattern space
at the end of each cycle through the script. 
These options disable this automatic printing,
and <code>sed</code> only produces output when explicitly told to
via the <code>p</code> command.

     <br><dt><code>-i[</code><var>SUFFIX</var><code>]</code>
     <dd><dt><code>--in-place[=</code><var>SUFFIX</var><code>]</code>
     <dd>This option specifies that files are to be edited in-place. 
<small>GNU</small> <code>sed</code> does this by creating a temporary file and
sending output to this file rather than to the standard
output.<a rel="footnote" href="#fn-1"><sup>1</sup></a>

     <p>When the end of the file is reached, the temporary file is
renamed to the output file's original name.

     <p>The extension, if supplied, is used to modify the name of
the old file before renaming the temporary file (thereby
making a backup copy<a rel="footnote" href="#fn-2"><sup>2</sup></a>) following
this rule: if the extension doesn't contain a <code>*</code>,
then it is appended to the end of the current filename
as a suffix; if the extension does contain one or more
<code>*</code> characters, then <em>each</em> asterisk is
replaced with the current filename.  This allows
you to add a prefix to the backup file, instead of (or in
addition to) a suffix, or even to place backup copies of
the original files into another directory (provided the
directory already exists).

     <p>This option implies <code>-s</code>.

     <br><dt><code>-l </code><var>N</var><code></code>
     <dd><dt><code>--line-length=</code><var>N</var><code></code>
     <dd>Specify the default line-wrap length for the <code>l</code> command. 
A length of 0 (zero) means to never wrap long lines.  If
not specified, it is taken to be 70.

     <br><dt><code>-r</code>
     <dd><dt><code>--regexp-extended</code>
     <dd>Use extended regular expressions rather than basic
regular expressions.  Extended regexps are those that
<code>egrep</code> accepts; they can be clearer because they
usually have less backslashes, but are a <small>GNU</small> extension
and hence scripts that use them are not portable. 
See <a href="#Extended%20regexps">Extended regular expressions</a>.

     <br><dt><code>-s</code>
     <dd><dt><code>--separate</code>
     <dd>By default, <code>sed</code> will consider the files specified on the
command line as a single continuous long stream.  This <small>GNU</small> <code>sed</code>
extension allows the user to consider them as separate files:
range addresses (such as <code>/abc/,/def/</code>) are not allowed
to span several files, line numbers are relative to the start
of each file, <code>$</code> refers to the last line of each file,
and files invoked from the <code>R</code> commands are rewound at the
start of each file.

     <br><dt><code>-u</code>
     <dd><dt><code>--unbuffered</code>
     <dd>Buffer both input and output as minimally as practical. 
(This is particularly useful if the input is coming from
the likes of <code>tail -f</code>, and you wish to see the transformed
output as soon as possible.)

     <br><dt><code>-e </code><var>script</var><code></code>
     <dd><dt><code>--expression=</code><var>script</var><code></code>
     <dd>Add the commands in <var>script</var> to the set of commands to be
run while processing the input.

     <br><dt><code>-f </code><var>script-file</var><code></code>
     <dd><dt><code>--file=</code><var>script-file</var><code></code>
     <dd>Add the commands contained in the file <var>script-file</var>
to the set of commands to be run while processing the input.

   </dl>

   <p>If no <code>-e</code>, <code>-f</code>, <code>--expression</code>, or <code>--file</code>
options are given on the command-line,
then the first non-option argument on the command line is
taken to be the <var>script</var> to be executed.

   <p>If any command-line parameters remain after processing the above,
these parameters are interpreted as the names of input files to
be processed. 
A file name of <code>-</code> refers to the standard input stream. 
The standard input will be processed if no file names are specified.

<div class="node">
<p><hr>
Node:&nbsp;<a name="sed%20Programs">sed Programs</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Examples">Examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Invoking%20sed">Invoking sed</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="chapter">3 <code>sed</code> Programs</h2>

<p>A <code>sed</code> program consists of one or more <code>sed</code> commands,
passed in by one or more of the
<code>-e</code>, <code>-f</code>, <code>--expression</code>, and <code>--file</code>
options, or the first non-option argument if zero of these
options are used. 
This document will refer to "the" <code>sed</code> script;
this is understood to mean the in-order catenation
of all of the <var>script</var>s and <var>script-file</var>s passed in.

   <p>Each <code>sed</code> command consists of an optional address or
address range, followed by a one-character command name
and any additional command-specific code.

<ul class="menu">
<li><a accesskey="1" href="#Addresses">Addresses</a>:                 Selecting lines with <code>sed</code>
<li><a accesskey="2" href="#Regular%20Expressions">Regular Expressions</a>:       Overview of regular expression syntax
<li><a accesskey="3" href="#Data%20Spaces">Data Spaces</a>:               Where <code>sed</code> buffers data
<li><a accesskey="4" href="#Common%20Commands">Common Commands</a>:           Often used commands
<li><a accesskey="5" href="#The%20%22s%22%20Command">The "s" Command</a>:           <code>sed</code>'s Swiss Army Knife
<li><a accesskey="6" href="#Other%20Commands">Other Commands</a>:            Less frequently used commands
<li><a accesskey="7" href="#Programming%20Commands">Programming Commands</a>:      Commands for <code>sed</code> gurus
<li><a accesskey="8" href="#Extended%20Commands">Extended Commands</a>:         Commands specific of <small>GNU</small> <code>sed</code>
<li><a accesskey="9" href="#Escapes">Escapes</a>:                   Specifying special characters
</ul>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Addresses">Addresses</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Regular%20Expressions">Regular Expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.1 Selecting lines with <code>sed</code></h3>

<p>Addresses in a <code>sed</code> script can be in any of the following forms:
     <dl>
<dt><code></code><var>number</var><code></code>
     <dd>Specifying a line number will match only that line in the input. 
(Note that <code>sed</code> counts lines continuously across all input files
unless <code>-i</code> or <code>-s</code> options are specified.)

     <br><dt><code></code><var>first</var><code>~</code><var>step</var><code></code>
     <dd>This <small>GNU</small> extension matches every <var>step</var>th line
starting with line <var>first</var>. 
In particular, lines will be selected when there exists
a non-negative <var>n</var> such that the current line-number equals
<var>first</var> + (<var>n</var> * <var>step</var>). 
Thus, to select the odd-numbered lines,
one would use <code>1~2</code>;
to pick every third line starting with the second, <code>2~3</code> would be used;
to pick every fifth line starting with the tenth, use <code>10~5</code>;
and <code>50~0</code> is just an obscure way of saying <code>50</code>.

     <br><dt><code>$</code>
     <dd>This address matches the last line of the last file of input, or
the last line of each file when the <code>-i</code> or <code>-s</code> options
are specified.

     <br><dt><code>/</code><var>regexp</var><code>/</code>
     <dd>This will select any line which matches the regular expression <var>regexp</var>. 
If <var>regexp</var> itself includes any <code>/</code> characters,
each must be escaped by a backslash (<code>\</code>).

     <p>Unless <code>POSIXLY_CORRECT</code> is set, the empty regular expression
<code>//</code> repeats the last regular expression match (the same holds
if the empty regular expression is passed to the <code>s</code> command). 
Note that modifiers to regular expressions are evaluated
when the regular expression is compiled, thus it is illegal to specify
them together with the empty regular expression. 
If <code>POSIXLY_CORRECT</code> is set, instead, <code>//</code> is the null match:
this behavior is mandated by <small>POSIX</small>, but it would break too many legacy
<code>sed</code> scripts to blithely change <small>GNU</small> <code>sed</code>'s default behavior.

     <br><dt><code>\%</code><var>regexp</var><code>%</code>
     <dd>(The <code>%</code> may be replaced by any other single character.)

     <p>This also matches the regular expression <var>regexp</var>,
but allows one to use a different delimiter than <code>/</code>. 
This is particularly useful if the <var>regexp</var> itself contains
a lot of slashes, since it avoids the tedious escaping of every <code>/</code>. 
If <var>regexp</var> itself includes any delimiter characters,
each must be escaped by a backslash (<code>\</code>).

     <br><dt><code>/</code><var>regexp</var><code>/I</code>
     <dd><dt><code>\%</code><var>regexp</var><code>%I</code>
     <dd>The <code>I</code> modifier to regular-expression matching is a <small>GNU</small>
extension which causes the <var>regexp</var> to be matched in
a case-insensitive manner.

     <br><dt><code>/</code><var>regexp</var><code>/M</code>
     <dd><dt><code>\%</code><var>regexp</var><code>%M</code>
     <dd>The <code>M</code> modifier to regular-expression matching is a <small>GNU</small> <code>sed</code>
extension which causes <code>^</code> and <code>$</code> to match respectively
(in addition to the normal behavior) the empty string after a newline,
and the empty string before a newline.  There are special character
sequences
(<code>\`</code> and <code>\'</code>)
which always match the beginning or the end of the buffer. 
<code>M</code> stands for <cite>multi-line</cite>.

   </dl>

   <p>If no addresses are given, then all lines are matched;
if one address is given, then only lines matching that
address are matched.

   <p>An address range can be specified by specifying two addresses
separated by a comma (<code>,</code>). 
An address range matches lines starting from where the first
address matches, and continues until the second address matches
(inclusively). 
If the second address is a <var>regexp</var>, then checking for the
ending match will start with the line <em>following</em> the
line which matched the first address.  As a <small>GNU</small> extension, a
line number of <code>0</code> can be used in an address specification
like <code>0,/</code><var>regexp</var><code>/</code> so that <var>regexp</var> will be
matched in the first input line too.

   <p>If the second address is a <var>number</var> less than (or equal to)
the line matching the first address,
then only the one line is matched.

   <small>GNU</small> <code>sed</code> also supports some special two-address forms:
     <dl>
<dt><code>0,</code><var>addr2</var><code></code>
     <dd>Start out in "matched first address" state,
until <var>addr2</var> is found. 
This is similar to <code>1,</code><var>addr2</var><code></code>,
except that if <var>addr2</var> matches the very first line of input
the 0,<var>addr2</var> form will be at the end of its range,
whereas the 1,<var>addr2</var> form will still be at the beginning of its range.

     <br><dt><code></code><var>addr1</var><code>,+</code><var>N</var><code></code>
     <dd>Matches <var>addr1</var> and the <var>N</var> lines following <var>addr1</var>.

     <br><dt><code></code><var>addr1</var><code>,~</code><var>N</var><code></code>
     <dd>Matches <var>addr1</var> and the lines following <var>addr1</var>
until the next line whose input line number is a multiple of <var>N</var>. 
</dl>

   <p>Appending the <code>!</code> character to the end of an address
specification negates the sense of the match. 
That is, if the <code>!</code> character follows an address range,
then only lines which do <em>not</em> match the address range
will be selected. 
This also works for singleton addresses,
and, perhaps perversely, for the null address.

<div class="node">
<p><hr>
Node:&nbsp;<a name="Regular%20Expressions">Regular Expressions</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Data%20Spaces">Data Spaces</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Addresses">Addresses</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.2 Overview of Regular Expression Syntax</h3>

<p>To know how to use <code>sed</code>, people should understand regular
expressions (<dfn>regexp</dfn> for short).  A regular expression
is a pattern that is matched against a
subject string from left to right.  Most characters are
<dfn>ordinary</dfn>: they stand for
themselves in a pattern, and match the corresponding characters
in the subject.  As a trivial example, the pattern

<pre class="example">          The quick brown fox
     </pre>

<p>matches a portion of a subject string that is identical to
itself.  The power of regular expressions comes from the
ability to include alternatives and repetitions in the pattern. 
These are encoded in the pattern by the use of <dfn>special characters</dfn>,
which do not stand for themselves but instead
are interpreted in some special way.  Here is a brief description
of regular expression syntax as used in <code>sed</code>.

     <dl>
<dt><code></code><var>char</var><code></code>
     <dd>A single ordinary character matches itself.

     <br><dt><code>*</code>
     <dd>Matches a sequence of zero or more instances of matches for the
preceding regular expression, which must be an ordinary character, a
special character preceded by <code>\</code>, a <code>.</code>, a grouped regexp
(see below), or a bracket expression.  As a <small>GNU</small> extension, a
postfixed regular expression can also be followed by <code>*</code>; for
example, <code>a**</code> is equivalent to <code>a*</code>.  <small>POSIX</small>
1003.1-2001 says that <code>*</code> stands for itself when it appears at
the start of a regular expression or subexpression, but many
non<small>GNU</small> implementations do not support this and portable
scripts should instead use <code>\*</code> in these contexts.

     <br><dt><code>\+</code>
     <dd>As <code>*</code>, but matches one or more.  It is a <small>GNU</small> extension.

     <br><dt><code>\?</code>
     <dd>As <code>*</code>, but only matches zero or one.  It is a <small>GNU</small> extension.

     <br><dt><code>\{</code><var>i</var><code>\}</code>
     <dd>As <code>*</code>, but matches exactly <var>i</var> sequences (<var>i</var> is a
decimal integer; for portability, keep it between 0 and 255
inclusive).

     <br><dt><code>\{</code><var>i</var><code>,</code><var>j</var><code>\}</code>
     <dd>Matches between <var>i</var> and <var>j</var>, inclusive, sequences.

     <br><dt><code>\{</code><var>i</var><code>,\}</code>
     <dd>Matches more than or equal to <var>i</var> sequences.

     <br><dt><code>\(</code><var>regexp</var><code>\)</code>
     <dd>Groups the inner <var>regexp</var> as a whole, this is used to:

          <ul>
<li>Apply postfix operators, like <code>\(abcd\)*</code>:
this will search for zero or more whole sequences
of <code>abcd</code>, while <code>abcd*</code> would search
for <code>abc</code> followed by zero or more occurrences
of <code>d</code>.  Note that support for <code>\(abcd\)*</code> is required by
<small>POSIX</small> 1003.1-2001, but many non-<small>GNU</small>
implementations do not support it and hence it is not universally
portable.

          <li>Use back references (see below). 
</ul>

     <br><dt><code>.</code>
     <dd>Matches any single character, including newline.

     <br><dt><code>^</code>
     <dd>Matches the null string at beginning of line, i.e. what
appears after the circumflex must appear at the
beginning of line. <code>^#include</code> will match only
lines where <code>#include</code> is the first thing on line--if
there are spaces before, for example, the match fails. 
<code>^</code> acts as a special character only at the beginning
of the regular expression or subexpression (that is, after <code>\(</code>
or <code>\|</code>).  Portable scripts should avoid <code>^</code> at the
beginning of a subexpression, though, as <small>POSIX</small> allows
implementations that treat <code>^</code> as an ordinary character in that
context.

     <br><dt><code>$</code>
     <dd>It is the same as <code>^</code>, but refers to end of line. 
<code>$</code> also acts as a special character only at the end
of the regular expression or subexpression (that is, before <code>\)</code>
or <code>\|</code>), and its use at the end of a subexpression is not
portable.

     <br><dt><code>[</code><var>list</var><code>]</code>
     <dd><dt><code>[^</code><var>list</var><code>]</code>
     <dd>Matches any single character in <var>list</var>: for example,
<code>[aeiou]</code> matches all vowels.  A list may include
sequences like <code></code><var>char1</var><code>-</code><var>char2</var><code></code>, which
matches any character between (inclusive) <var>char1</var>
and <var>char2</var>.

     <p>A leading <code>^</code> reverses the meaning of <var>list</var>, so that
it matches any single character <em>not</em> in <var>list</var>.  To include
<code>]</code> in the list, make it the first character (after
the <code>^</code> if needed), to include <code>-</code> in the list,
make it the first or last; to include <code>^</code> put
it after the first character.

     <p>The characters <code>$</code>, <code>*</code>, <code>.</code>, <code>[</code>, and <code>\</code>
are normally not special within <var>list</var>.  For example, <code>[\*]</code>
matches either <code>\</code> or <code>*</code>, because the <code>\</code> is not
special here.  However, strings like <code>[.ch.]</code>, <code>[=a=]</code>, and
<code>[:space:]</code> are special within <var>list</var> and represent collating
symbols, equivalence classes, and character classes, respectively, and
<code>[</code> is therefore special within <var>list</var> when it is followed by
<code>.</code>, <code>=</code>, or <code>:</code>.  Special escapes like <code>\n</code> and
<code>\t</code> are recognized within <var>list</var>; this will change in a
future version in <code>POSIXLY_CORRECT</code> mode.  See <a href="#Escapes">Escapes</a>.

     <br><dt><code></code><var>regexp1</var><code>\|</code><var>regexp2</var><code></code>
     <dd>Matches either <var>regexp1</var> or <var>regexp2</var>.  Use
parentheses to use complex alternative regular expressions. 
The matching process tries each alternative in turn, from
left to right, and the first one that succeeds is used. 
It is a <small>GNU</small> extension.

     <br><dt><code></code><var>regexp1</var><code></code><var>regexp2</var><code></code>
     <dd>Matches the concatenation of <var>regexp1</var> and <var>regexp2</var>. 
Concatenation binds more tightly than <code>\|</code>, <code>^</code>, and
<code>$</code>, but less tightly than the other regular expression
operators.

     <br><dt><code>\</code><var>digit</var><code></code>
     <dd>Matches the <var>digit</var>-th <code>\(...\)</code> parenthesized
subexpression in the regular expression.  This is called a <dfn>back
reference</dfn>.  Subexpressions are implicity numbered by counting
occurrences of <code>\(</code> left-to-right.

     <br><dt><code>\n</code>
     <dd>Matches the newline character.

     <br><dt><code>\</code><var>char</var><code></code>
     <dd>Matches <var>char</var>, where <var>char</var> is one of <code>$</code>,
<code>*</code>, <code>.</code>, <code>[</code>, <code>\</code>, or <code>^</code>. 
Note that the only C-like
backslash sequences that you can portably assume to be
interpreted are <code>\n</code> and <code>\\</code>; in particular
<code>\t</code> is not portable, and matches a <code>t</code> under most
implementations of <code>sed</code>, rather than a tab character.

   </dl>

   <p>Note that the regular expression matcher is greedy, i.e., if
two or more matches are detected, it selects the longest; if
there are two or more selected with the same size, it
selects the first in text.

<p>Examples:
     <dl>
<dt><code>abcdef</code>
     <dd>Matches <code>abcdef</code>.

     <br><dt><code>a*b</code>
     <dd>Matches zero or more <code>a</code>s followed by a single
<code>b</code>.  For example, <code>b</code> or <code>aaaaab</code>.

     <br><dt><code>a\?b</code>
     <dd>Matches <code>b</code> or <code>ab</code>.

     <br><dt><code>a\+b\+</code>
     <dd>Matches one or more <code>a</code>s followed by one or more
<code>b</code>s: <code>ab</code> is the shortest possible match, but
other examples are <code>aaaab</code> or <code>abbbbb</code> or
<code>aaaaaabbbbbbb</code>.

     <br><dt><code>.*</code>
     <dd><dt><code>.\+</code>
     <dd>These two both match all the characters in a string;
however, the first matches every string (including the empty
string), while the second matches only strings containing
at least one character.

     <br><dt><code>^main.*(.*)</code>
     <dd>This matches a string starting with <code>main</code>,
followed by an opening and closing
parenthesis.  The <code>n</code>, <code>(</code> and <code>)</code> need not
be adjacent.

     <br><dt><code>^#</code>
     <dd>This matches a string beginning with <code>#</code>.

     <br><dt><code>\\$</code>
     <dd>This matches a string ending with a single backslash.  The
regexp contains two backslashes for escaping.

     <br><dt><code>\$</code>
     <dd>Instead, this matches a string consisting of a single dollar sign,
because it is escaped.

     <br><dt><code>[a-zA-Z0-9]</code>
     <dd>In the C locale, this matches any <small>ASCII</small> letters or digits.

     <br><dt><code>[^ </code><kbd>tab</kbd><code>]\+</code>
     <dd>(Here <kbd>tab</kbd> stands for a single tab character.) 
This matches a string of one or more
characters, none of which is a space or a tab. 
Usually this means a word.

     <br><dt><code>^\(.*\)\n\1$</code>
     <dd>This matches a string consisting of two equal substrings separated by
a newline.

     <br><dt><code>.\{9\}A$</code>
     <dd>This matches nine characters followed by an <code>A</code>.

     <br><dt><code>^.\{15\}A</code>
     <dd>This matches the start of a string that contains 16 characters,
the last of which is an <code>A</code>.

   </dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Data%20Spaces">Data Spaces</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Common%20Commands">Common Commands</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Regular%20Expressions">Regular Expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.3 Where <code>sed</code> Buffers Data</h3>

<p><code>sed</code> maintains two data buffers: the active <em>pattern</em> space,
and the auxiliary <em>hold</em> space. 
In "normal" operation, <code>sed</code> reads in one line from the
input stream and places it in the pattern space. 
This pattern space is where text manipulations occur. 
The hold space is initially empty, but there are commands
for moving data between the pattern and hold spaces.

<div class="node">
<p><hr>
Node:&nbsp;<a name="Common%20Commands">Common Commands</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#The%20%22s%22%20Command">The "s" Command</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Data%20Spaces">Data Spaces</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.4 Often-Used Commands</h3>

<p>If you use <code>sed</code> at all, you will quite likely want to know
these commands.

     <dl>
<dt><code>#</code>
     <dd>[No addresses allowed.]

     <p>The <code>#</code> character begins a comment;
the comment continues until the next newline.

     <p>If you are concerned about portability, be aware that
some implementations of <code>sed</code> (which are not <small>POSIX</small>
conformant) may only support a single one-line comment,
and then only when the very first character of the script is a <code>#</code>.

     <p>Warning: if the first two characters of the <code>sed</code> script
are <code>#n</code>, then the <code>-n</code> (no-autoprint) option is forced. 
If you want to put a comment in the first line of your script
and that comment begins with the letter <code>n</code>
and you do not want this behavior,
then be sure to either use a capital <code>N</code>,
or place at least one space before the <code>n</code>.

     <br><dt><code>q [</code><var>exit-code</var><code>]</code>
     <dd>This command only accepts a single address.

     <p>Exit <code>sed</code> without processing any more commands or input. 
Note that the current pattern space is printed if auto-print is
not disabled with the <code>-n</code> options.  The ability to return
an exit code from the <code>sed</code> script is a <small>GNU</small> <code>sed</code> extension.

     <br><dt><code>d</code>
     <dd>Delete the pattern space;
immediately start next cycle.

     <br><dt><code>p</code>
     <dd>Print out the pattern space (to the standard output). 
This command is usually only used in conjunction with the <code>-n</code>
command-line option.

     <p>Note: some implementations of <code>sed</code>, such as this one, will
double-print lines when auto-print is not disabled and the <code>p</code>
command is given. 
Other implementations will only print the line once. 
Both ways conform with the <small>POSIX</small> standard, and so neither
way can be considered to be in error.

     <p>Portable <code>sed</code> scripts should thus avoid relying on either behavior;
either use the <code>-n</code> option and explicitly print what you want,
or avoid use of the <code>p</code> command (and also the <code>p</code> flag to the
<code>s</code> command).

     <br><dt><code>n</code>
     <dd>If auto-print is not disabled, print the pattern space,
then, regardless, replace the pattern space with the next line of input. 
If there is no more input then <code>sed</code> exits without processing
any more commands.

     <br><dt><code>{ </code><var>commands</var><code> }</code>
     <dd>A group of commands may be enclosed between
<code>{</code> and <code>}</code> characters. 
This is particularly useful when you want a group of commands
to be triggered by a single address (or address-range) match.

   </dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="The%20%22s%22%20Command">The "s" Command</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Other%20Commands">Other Commands</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Common%20Commands">Common Commands</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.5 The <code>s</code> Command</h3>

<p>The syntax of the <code>s</code> (as in substitute) command is
<code>s/</code><var>regexp</var><code>/</code><var>replacement</var><code>/</code><var>flags</var><code></code>.  The <code>/</code>
characters may be uniformly replaced by any other single
character within any given <code>s</code> command.  The <code>/</code>
character (or whatever other character is used in its stead)
can appear in the <var>regexp</var> or <var>replacement</var>
only if it is preceded by a <code>\</code> character.

   <p>The <code>s</code> command is probably the most important in <code>sed</code>
and has a lot of different options.  Its basic concept is simple:
the <code>s</code> command attempts to match the pattern
space against the supplied <var>regexp</var>; if the match is
successful, then that portion of the pattern
space which was matched is replaced with <var>replacement</var>.

   <p>The <var>replacement</var> can contain <code>\</code><var>n</var><code></code> (<var>n</var> being
a number from 1 to 9, inclusive) references, which refer to
the portion of the match which is contained between the <var>n</var>th
<code>\(</code> and its matching <code>\)</code>. 
Also, the <var>replacement</var> can contain unescaped <code>&amp;</code>
characters which reference the whole matched portion
of the pattern space. 
Finally (this is a <small>GNU</small> <code>sed</code> extension) you can include a
special sequence made of a backslash and one of the letters
<code>L</code>, <code>l</code>, <code>U</code>, <code>u</code>, or <code>E</code>. 
The meaning is as follows:

     <dl>
<dt><code>\L</code>
     <dd>Turn the replacement
to lowercase until a <code>\U</code> or <code>\E</code> is found,

     <br><dt><code>\l</code>
     <dd>Turn the
next character to lowercase,

     <br><dt><code>\U</code>
     <dd>Turn the replacement to uppercase
until a <code>\L</code> or <code>\E</code> is found,

     <br><dt><code>\u</code>
     <dd>Turn the next character
to uppercase,

     <br><dt><code>\E</code>
     <dd>Stop case conversion started by <code>\L</code> or <code>\U</code>. 
</dl>

   <p>To include a literal <code>\</code>, <code>&amp;</code>, or newline in the final
replacement, be sure to precede the desired <code>\</code>, <code>&amp;</code>,
or newline in the <var>replacement</var> with a <code>\</code>.

   <p>The <code>s</code> command can be followed by zero or more of the
following <var>flags</var>:

     <dl>
<dt><code>g</code>
     <dd>Apply the replacement to <em>all</em> matches to the <var>regexp</var>,
not just the first.

     <br><dt><code></code><var>number</var><code></code>
     <dd>Only replace the <var>number</var>th match of the <var>regexp</var>.

     <p>Note: the <small>POSIX</small> standard does not specify what should happen
when you mix the <code>g</code> and <var>number</var> modifiers,
and currently there is no widely agreed upon meaning
across <code>sed</code> implementations. 
For <small>GNU</small> <code>sed</code>, the interaction is defined to be:
ignore matches before the <var>number</var>th,
and then match and replace all matches from
the <var>number</var>th on.

     <br><dt><code>p</code>
     <dd>If the substitution was made, then print the new pattern space.

     <p>Note: when both the <code>p</code> and <code>e</code> options are specified,
the relative ordering of the two produces very different results. 
In general, <code>ep</code> (evaluate then print) is what you want,
but operating the other way round can be useful for debugging. 
For this reason, the current version of <small>GNU</small> <code>sed</code> interprets
specially the presence of <code>p</code> options both before and after
<code>e</code>, printing the pattern space before and after evaluation,
while in general flags for the <code>s</code> command show their
effect just once.  This behavior, although documented, might
change in future versions.

     <br><dt><code>w </code><var>file-name</var><code></code>
     <dd>If the substitution was made, then write out the result to the named file. 
As a <small>GNU</small> <code>sed</code> extension, two special values of <var>file-name</var> are
supported: <code>/dev/stderr</code>, which writes the result to the standard
error, and <code>/dev/stdout</code>, which writes to the standard
output.<a rel="footnote" href="#fn-3"><sup>3</sup></a>

     <br><dt><code>e</code>
     <dd>This command allows one to pipe input from a shell command
into pattern space.  If a substitution was made, the command
that is found in pattern space is executed and pattern space
is replaced with its output.  A trailing newline is suppressed;
results are undefined if the command to be executed contains
a <small>NUL</small> character.  This is a <small>GNU</small> <code>sed</code> extension.

     <br><dt><code>I</code>
     <dd><dt><code>i</code>
     <dd>The <code>I</code> modifier to regular-expression matching is a <small>GNU</small>
extension which makes <code>sed</code> match <var>regexp</var> in a
case-insensitive manner.

     <br><dt><code>M</code>
     <dd><dt><code>m</code>
     <dd>The <code>M</code> modifier to regular-expression matching is a <small>GNU</small> <code>sed</code>
extension which causes <code>^</code> and <code>$</code> to match respectively
(in addition to the normal behavior) the empty string after a newline,
and the empty string before a newline.  There are special character
sequences
(<code>\`</code> and <code>\'</code>)
which always match the beginning or the end of the buffer. 
<code>M</code> stands for <cite>multi-line</cite>.

   </dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Other%20Commands">Other Commands</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Programming%20Commands">Programming Commands</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The%20%22s%22%20Command">The "s" Command</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.6 Less Frequently-Used Commands</h3>

<p>Though perhaps less frequently used than those in the previous
section, some very small yet useful <code>sed</code> scripts can be built with
these commands.

     <dl>
<dt><code>y/</code><var>source-chars</var><code>/</code><var>dest-chars</var><code>/</code>
     <dd>(The <code>/</code> characters may be uniformly replaced by
any other single character within any given <code>y</code> command.)

     <p>Transliterate any characters in the pattern space which match
any of the <var>source-chars</var> with the corresponding character
in <var>dest-chars</var>.

     <p>Instances of the <code>/</code> (or whatever other character is used in its stead),
<code>\</code>, or newlines can appear in the <var>source-chars</var> or <var>dest-chars</var>
lists, provide that each instance is escaped by a <code>\</code>. 
The <var>source-chars</var> and <var>dest-chars</var> lists <em>must</em>
contain the same number of characters (after de-escaping).

     <br><dt><code>a\</code>
     <dd><dt><code></code><var>text</var><code></code>
     <dd>In <code>POSIXLY_CORRECT</code> mode, this command only accepts a single
address.

     <p>Queue the lines of text which follow this command
(each but the last ending with a <code>\</code>,
which are removed from the output)
to be output at the end of the current cycle,
or when the next input line is read.

     <p>As a <small>GNU</small> extension, if between the <code>a</code> and the newline there is
other than a whitespace-<code>\</code> sequence, then the text of this line,
starting at the first non-whitespace character after the <code>a</code>,
is taken as the first line of the <var>text</var> block. 
(This enables a simplification in scripting a one-line add.) 
This extension also works with the <code>i</code> and <code>c</code> commands.

     <br><dt><code>i\</code>
     <dd><dt><code></code><var>text</var><code></code>
     <dd>In <code>POSIXLY_CORRECT</code> mode, this command only accepts a single
address.

     <p>Immediately output the lines of text which follow this command
(each but the last ending with a <code>\</code>,
which are removed from the output).

     <br><dt><code>c\</code>
     <dd><dt><code></code><var>text</var><code></code>
     <dd>Delete the lines matching the address or address-range,
and output the lines of text which follow this command
(each but the last ending with a <code>\</code>,
which are removed from the output)
in place of the last line
(or in place of each line, if no addresses were specified). 
A new cycle is started after this command is done,
since the pattern space will have been deleted.

     <br><dt><code>=</code>
     <dd>In <code>POSIXLY_CORRECT</code> mode, this command only accepts a single
address.

     <p>Print out the current input line number (with a trailing newline).

     <br><dt><code>l </code><var>n</var><code></code>
     <dd>Print the pattern space in an unambiguous form:
non-printable characters (and the <code>\</code> character)
are printed in C-style escaped form; long lines are split,
with a trailing <code>\</code> character to indicate the split;
the end of each line is marked with a <code>$</code>.

     <p><var>n</var> specifies the desired line-wrap length;
a length of 0 (zero) means to never wrap long lines.  If omitted,
the default as specified on the command line is used.  The <var>n</var>
parameter is a <small>GNU</small> <code>sed</code> extension.

     <br><dt><code>r </code><var>filename</var><code></code>
     <dd>In <code>POSIXLY_CORRECT</code> mode, this command only accepts a single
address.

     <p>Queue the contents of <var>filename</var> to be read and
inserted into the output stream at the end of the current cycle,
or when the next input line is read. 
Note that if <var>filename</var> cannot be read, it is treated as
if it were an empty file, without any error indication.

     <p>As a <small>GNU</small> <code>sed</code> extension, the special value <code>/dev/stdin</code>
is supported for the file name, which reads the contents of the
standard input.

     <br><dt><code>w </code><var>filename</var><code></code>
     <dd>Write the pattern space to <var>filename</var>. 
As a <small>GNU</small> <code>sed</code> extension, two special values of <var>file-name</var> are
supported: <code>/dev/stderr</code>, which writes the result to the standard
error, and <code>/dev/stdout</code>, which writes to the standard
output.<a rel="footnote" href="#fn-4"><sup>4</sup></a>

     <p>The file will be created (or truncated) before the
first input line is read; all <code>w</code> commands
(including instances of <code>w</code> flag on successful <code>s</code> commands)
which refer to the same <var>filename</var> are output without
closing and reopening the file.

     <br><dt><code>D</code>
     <dd>Delete text in the pattern space up to the first newline. 
If any text is left, restart cycle with the resultant
pattern space (without reading a new line of input),
otherwise start a normal new cycle.

     <br><dt><code>N</code>
     <dd>Add a newline to the pattern space,
then append the next line of input to the pattern space. 
If there is no more input then <code>sed</code> exits without processing
any more commands.

     <br><dt><code>P</code>
     <dd>Print out the portion of the pattern space up to the first newline.

     <br><dt><code>h</code>
     <dd>Replace the contents of the hold space with the contents of the pattern space.

     <br><dt><code>H</code>
     <dd>Append a newline to the contents of the hold space,
and then append the contents of the pattern space to that of the hold space.

     <br><dt><code>g</code>
     <dd>Replace the contents of the pattern space with the contents of the hold space.

     <br><dt><code>G</code>
     <dd>Append a newline to the contents of the pattern space,
and then append the contents of the hold space to that of the pattern space.

     <br><dt><code>x</code>
     <dd>Exchange the contents of the hold and pattern spaces.

   </dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Programming%20Commands">Programming Commands</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Extended%20Commands">Extended Commands</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Other%20Commands">Other Commands</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.7 Commands for <code>sed</code> gurus</h3>

<p>In most cases, use of these commands indicates that you are
probably better off programming in something like <code>awk</code>
or Perl.  But occasionally one is committed to sticking
with <code>sed</code>, and these commands can enable one to write
quite convoluted scripts.

     <dl>
<dt><code>: </code><var>label</var><code></code>
     <dd>[No addresses allowed.]

     <p>Specify the location of <var>label</var> for branch commands. 
In all other respects, a no-op.

     <br><dt><code>b </code><var>label</var><code></code>
     <dd>Unconditionally branch to <var>label</var>. 
The <var>label</var> may be omitted, in which case the next cycle is started.

     <br><dt><code>t </code><var>label</var><code></code>
     <dd>Branch to <var>label</var> only if there has been a successful <code>s</code>ubstitution
since the last input line was read or conditional branch was taken. 
The <var>label</var> may be omitted, in which case the next cycle is started.

   </dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Extended%20Commands">Extended Commands</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Escapes">Escapes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Programming%20Commands">Programming Commands</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.8 Commands Specific to <small>GNU</small> <code>sed</code></h3>

<p>These commands are specific to <small>GNU</small> <code>sed</code>, so you
must use them with care and only when you are sure that
hindering portability is not evil.  They allow you to check
for <small>GNU</small> <code>sed</code> extensions or to do tasks that are required
quite often, yet are unsupported by standard <code>sed</code>s.

     <dl>
<dt><code>e [</code><var>command</var><code>]</code>
     <dd>This command allows one to pipe input from a shell command
into pattern space.  Without parameters, the <code>e</code> command
executes the command that is found in pattern space and
replaces the pattern space with the output; a trailing newline
is suppressed.

     <p>If a parameter is specified, instead, the <code>e</code> command
interprets it as a command and sends its output to the output stream
(like <code>r</code> does).  The command can run across multiple
lines, all but the last ending with a back-slash.

     <p>In both cases, the results are undefined if the command to be
executed contains a <small>NUL</small> character.

     <br><dt><code>L </code><var>n</var><code></code>
     <dd>In <code>POSIXLY_CORRECT</code> mode, this command only accepts a single
address.

     <p>This <small>GNU</small> <code>sed</code> extension fills and joins lines in pattern space
to produce output lines of (at most) <var>n</var> characters, like
<code>fmt</code> does; if <var>n</var> is omitted, the default as specified
on the command line is used.

     <p>Blank lines, spaces between words, and indentation are
preserved in the output; successive input lines with different
indentation are not joined; tabs are expanded to 8 columns.

     <p>If the pattern space contains multiple lines, they are joined, but
since the pattern space usually contains a single line, the behavior
of a simple <code>L;d</code> script is the same as <code>fmt -s</code> (i.e.,
it does not join short lines to form longer ones).

     <p><var>n</var> specifies the desired line-wrap length; if omitted,
the default as specified on the command line is used.

     <br><dt><code>Q [</code><var>exit-code</var><code>]</code>
     <dd>This command only accepts a single address.

     <p>This command is the same as <code>q</code>, but will not print the
contents of pattern space.  Like <code>q</code>, it provides the
ability to return an exit code to the caller.

     <p>This command can be useful because the only alternative ways
to accomplish this apparently trivial function are to use
the <code>-n</code> option (which can unnecessarily complicate
your script) or resorting to the following snippet, which
wastes time by reading the whole file without any visible effect:

     <pre class="example">          :eat
          $d       <i>Quit silently on the last line</i>
          N        <i>Read another line, silently</i>
          g        <i>Overwrite pattern space each time to save memory</i>
          b eat
          </pre>

     <br><dt><code>R </code><var>filename</var><code></code>
     <dd>Queue a line of <var>filename</var> to be read and
inserted into the output stream at the end of the current cycle,
or when the next input line is read. 
Note that if <var>filename</var> cannot be read, or if its end is
reached, no line is appended, without any error indication.

     <p>As with the <code>r</code> command, the special value <code>/dev/stdin</code>
is supported for the file name, which reads a line from the
standard input.

     <br><dt><code>T </code><var>label</var><code></code>
     <dd>Branch to <var>label</var> only if there have been no successful
<code>s</code>ubstitutions since the last input line was read or
conditional branch was taken. The <var>label</var> may be omitted,
in which case the next cycle is started.

     <br><dt><code>v </code><var>version</var><code></code>
     <dd>This command does nothing, but makes <code>sed</code> fail if
<small>GNU</small> <code>sed</code> extensions are not supported, simply because other
versions of <code>sed</code> do not implement it.  In addition, you
can specify the version of <code>sed</code> that your script
requires, such as <code>4.0.5</code>.  The default is <code>4.0</code>
because that is the first version that implemented this command.

     <p>This commands also enables <small>GNU</small> extensions unconditionally, even
if <code>POSIXLY_CORRECT</code> is set in the environment.

     <br><dt><code>W </code><var>filename</var><code></code>
     <dd>Write to the given filename the portion of the pattern space up to
the first newline.  Everything said under the <code>w</code> command about
file handling holds here too. 
</dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Escapes">Escapes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Extended%20Commands">Extended Commands</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sed%20Programs">sed Programs</a>
<br>
</div>

<h3 class="section">3.9 <small>GNU</small> Extensions for Escapes in Regular Expressions</h3>

<p>Until this chapter, we have only encountered escapes of the form
<code>\^</code>, which tell <code>sed</code> not to interpret the circumflex
as a special character, but rather to take it literally.  For
example, <code>\*</code> matches a single asterisk rather than zero
or more backslashes.

   <p>This chapter introduces another kind of escape<a rel="footnote" href="#fn-5"><sup>5</sup></a>--that
is, escapes that are applied to a character or sequence of characters
that ordinarily are taken literally, and that <code>sed</code> replaces
with a special character.  This provides a way
of encoding non-printable characters in patterns in a visible manner. 
There is no restriction on the appearance of non-printing characters
in a <code>sed</code> script but when a script is being prepared in the
shell or by text editing, it is usually easier to use one of
the following escape sequences than the binary character it
represents:

   <p>The list of these escapes is:

     <dl>
<dt><code>\a</code>
     <dd>Produces or matches a <small>BEL</small> character, that is an "alert" (<small>ASCII</small> 7).

     <br><dt><code>\f</code>
     <dd>Produces or matches a form feed (<small>ASCII</small> 12).

     <br><dt><code>\n</code>
     <dd>Produces or matches a newline (<small>ASCII</small> 10).

     <br><dt><code>\r</code>
     <dd>Produces or matches a carriage return (<small>ASCII</small> 13).

     <br><dt><code>\t</code>
     <dd>Produces or matches a horizontal tab (<small>ASCII</small> 9).

     <br><dt><code>\v</code>
     <dd>Produces or matches a so called "vertical tab" (<small>ASCII</small> 11).

     <br><dt><code>\c</code><var>x</var><code></code>
     <dd>Produces or matches <kbd></kbd><SMALL>CONTROL</small><kbd>-</kbd><var>x</var><kbd></kbd>, where <var>x</var> is
any character.  The precise effect of <code>\c</code><var>x</var><code></code> is as follows:
if <var>x</var> is a lower case letter, it is converted to upper case. 
Then bit 6 of the character (hex 40) is inverted.  Thus <code>\cz</code> becomes
hex 1A, but <code>\c{</code> becomes hex 3B, while <code>\c;</code> becomes hex 7B.

     <br><dt><code>\d</code><var>xxx</var><code></code>
     <dd>Produces or matches a character whose decimal <small>ASCII</small> value is <var>xxx</var>.

     <br><dt><code>\o</code><var>xxx</var><code></code>
     <dd>Produces or matches a character whose octal <small>ASCII</small> value is <var>xxx</var>.

     <br><dt><code>\x</code><var>xx</var><code></code>
     <dd>Produces or matches a character whose hexadecimal <small>ASCII</small> value is <var>xx</var>. 
</dl>

   <p><code>\b</code> (backspace) was omitted because of the conflict with
the existing "word boundary" meaning.

   <p>Other escapes match a particular character class and are valid only in
regular expressions:

     <dl>
<dt><code>\w</code>
     <dd>Matches any "word" character.  A "word" character is any
letter or digit or the underscore character.

     <br><dt><code>\W</code>
     <dd>Matches any "non-word" character.

     <br><dt><code>\b</code>
     <dd>Matches a word boundary; that is it matches if the character
to the left is a "word" character and the character to the
right is a "non-word" character, or vice-versa.

     <br><dt><code>\B</code>
     <dd>Matches everywhere but on a word boundary; that is it matches
if the character to the left and the character to the right
are either both "word" characters or both "non-word"
characters.

     <br><dt><code>\`</code>
     <dd>Matches only at the start of pattern space.  This is different
from <code>^</code> in multi-line mode.

     <br><dt><code>\'</code>
     <dd>Matches only at the end of pattern space.  This is different
from <code>$</code> in multi-line mode. 
</dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Examples">Examples</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Limitations">Limitations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sed%20Programs">sed Programs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="chapter">4 Some Sample Scripts</h2>

<p>Here are some <code>sed</code> scripts to guide you in the art of mastering
<code>sed</code>.

<p>Some exotic examples:
<ul class="menu">
<li><a accesskey="1" href="#Centering%20lines">Centering lines</a>: 
<li><a accesskey="2" href="#Increment%20a%20number">Increment a number</a>: 
<li><a accesskey="3" href="#Rename%20files%20to%20lower%20case">Rename files to lower case</a>: 
<li><a accesskey="4" href="#Print%20bash%20environment">Print bash environment</a>: 
<li><a accesskey="5" href="#Reverse%20chars%20of%20lines">Reverse chars of lines</a>:

<p>Emulating standard utilities:
</p><li><a accesskey="6" href="#tac">tac</a>:                              Reverse lines of files
<li><a accesskey="7" href="#cat%20-n">cat -n</a>:                           Numbering lines
<li><a accesskey="8" href="#cat%20-b">cat -b</a>:                           Numbering non-blank lines
<li><a accesskey="9" href="#wc%20-c">wc -c</a>:                            Counting chars
<li><a href="#wc%20-w">wc -w</a>:                            Counting words
<li><a href="#wc%20-l">wc -l</a>:                            Counting lines
<li><a href="#head">head</a>:                             Printing the first lines
<li><a href="#tail">tail</a>:                             Printing the last lines
<li><a href="#uniq">uniq</a>:                             Make duplicate lines unique
<li><a href="#uniq%20-d">uniq -d</a>:                          Print duplicated lines of input
<li><a href="#uniq%20-u">uniq -u</a>:                          Remove all duplicated lines
<li><a href="#cat%20-s">cat -s</a>:                           Squeezing blank lines
</ul>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Centering%20lines">Centering lines</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Increment%20a%20number">Increment a number</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.1 Centering Lines</h3>

<p>This script centers all lines of a file on a 80 columns width. 
To change that width, the number in <code>\{...\}</code> must be
replaced, and the number of added spaces also must be changed.

   <p>Note how the buffer commands are used to separate parts in
the regular expressions to be matched--this is a common
technique.

<pre class="example">     #!/usr/bin/sed -f
     
     # Put 80 spaces in the buffer
     1 {
       x
       s/^$/          /
       s/^.*$/&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;/
       x
     }
     
     # del leading and trailing spaces
     y/<kbd>tab</kbd>/ /
     s/^ *//
     s/ *$//
     
     # add a newline and 80 spaces to end of line
     G
     
     # keep first 81 chars (80 + a newline)
     s/^\(.\{81\}\).*$/\1/
     
     # \2 matches half of the spaces, which are moved to the beginning
     s/^\(.*\)\n\(.*\)\2/\2\1/
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Increment%20a%20number">Increment a number</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Rename%20files%20to%20lower%20case">Rename files to lower case</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Centering%20lines">Centering lines</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.2 Increment a Number</h3>

<p>This script is one of a few that demonstrate how to do arithmetic
in <code>sed</code>.  This is indeed possible,<a rel="footnote" href="#fn-6"><sup>6</sup></a> but must be done manually.

   <p>To increment one number you just add 1 to last digit, replacing
it by the following digit.  There is one exception: when the digit
is a nine the previous digits must be also incremented until you
don't have a nine.

   <p>This solution by Bruno Haible is very clever and smart because
it uses a single buffer; if you don't have this limitation, the
algorithm used in <a href="#cat%20-n">Numbering lines</a>, is faster. 
It works by replacing trailing nines with an underscore, then
using multiple <code>s</code> commands to increment the last digit,
and then again substituting underscores with zeros.

<pre class="example">     #!/usr/bin/sed -f
     
     /[^0-9]/ d
     
     # replace all leading 9s by _ (any other character except digits, could
     # be used)
     :d
     s/9\(_*\)$/_\1/
     td
     
     # incr last digit only.  The first line adds a most-significant
     # digit of 1 if we have to add a digit.
     #
     # The <code>tn</code> commands are not necessary, but make the thing
     # faster
     
     s/^\(_*\)$/1\1/; tn
     s/8\(_*\)$/9\1/; tn
     s/7\(_*\)$/8\1/; tn
     s/6\(_*\)$/7\1/; tn
     s/5\(_*\)$/6\1/; tn
     s/4\(_*\)$/5\1/; tn
     s/3\(_*\)$/4\1/; tn
     s/2\(_*\)$/3\1/; tn
     s/1\(_*\)$/2\1/; tn
     s/0\(_*\)$/1\1/; tn
     
     :n
     y/_/0/
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Rename%20files%20to%20lower%20case">Rename files to lower case</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Print%20bash%20environment">Print bash environment</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Increment%20a%20number">Increment a number</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.3 Rename Files to Lower Case</h3>

<p>This is a pretty strange use of <code>sed</code>.  We transform text, and
transform it to be shell commands, then just feed them to shell. 
Don't worry, even worse hacks are done when using <code>sed</code>; I have
seen a script converting the output of <code>date</code> into a <code>bc</code>
program!

   <p>The main body of this is the <code>sed</code> script, which remaps the name
from lower to upper (or vice-versa) and even checks out
if the remapped name is the same as the original name. 
Note how the script is parameterized using shell
variables and proper quoting.

<pre class="example">     #! /bin/sh
     # rename files to lower/upper case...
     #
     # usage:
     #    move-to-lower *
     #    move-to-upper *
     # or
     #    move-to-lower -R .
     #    move-to-upper -R .
     #
     
     help()
     {
     	cat &lt;&lt; eof
     Usage: $0 [-n] [-r] [-h] files...
     
     -n      do nothing, only see what would be done
     -R      recursive (use find)
     -h      this message
     files   files to remap to lower case
     
     Examples:
            $0 -n *        (see if everything is ok, then...)
            $0 *
     
            $0 -R .
     
     eof
     }
     
     apply_cmd='sh'
     finder='echo "$&uml;| tr " " "\n"'
     files_only=
     
     while :
     do
         case "$1" in
             -n) apply_cmd='cat' ;;
             -R) finder='find "$&uml;-type f';;
             -h) help ; exit 1 ;;
             *) break ;;
         esac
         shift
     done
     
     if [ -z "$1" ]; then
             echo Usage: $0 [-h] [-n] [-r] files...
             exit 1
     fi
     
     LOWER='abcdefghijklmnopqrstuvwxyz'
     UPPER='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
     
     case `basename $0` in
             *upper*) TO=$UPPER; FROM=$LOWER ;;
             *)       FROM=$UPPER; TO=$LOWER ;;
     esac
     
     eval $finder | sed -n '
     
     # remove all trailing slashes
     s/\/*$//
     
     # add ./ if there is no path, only a filename
     /\//! s/^/.\//
     
     # save path+filename
     h
     
     # remove path
     s/.*\///
     
     # do conversion only on filename
     y/'$FROM'/'$TO'/
     
     # now line contains original path+file, while
     # hold space contains the new filename
     x
     
     # add converted file name to line, which now contains
     # path/file-name\nconverted-file-name
     G
     
     # check if converted file name is equal to original file name,
     # if it is, do not print nothing
     /^.*\/\(.*\)\n\1/b
     
     # now, transform path/fromfile\n, into
     # mv path/fromfile path/tofile and print it
     s/^\(.*\/\)\(.*\)\n\(.*\)$/mv \1\2 \1\3/p
     
     ' | $apply_cmd
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Print%20bash%20environment">Print bash environment</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Reverse%20chars%20of%20lines">Reverse chars of lines</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Rename%20files%20to%20lower%20case">Rename files to lower case</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.4 Print <code>bash</code> Environment</h3>

<p>This script strips the definition of the shell functions
from the output of the <code>set</code> Bourne-shell command.

<pre class="example">     #!/bin/sh
     
     set | sed -n '
     :x
     
     # if no occurrence of <code>=()</code> print and load next line
     /=()/! { p; b; }
     / () $/! { p; b; }
     
     # possible start of functions section
     # save the line in case this is a var like FOO="() "
     h
     
     # if the next line has a brace, we quit because
     # nothing comes after functions
     n
     /^{/ q
     
     # print the old line
     x; p
     
     # work on the new line now
     x; bx
     '
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Reverse%20chars%20of%20lines">Reverse chars of lines</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#tac">tac</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Print%20bash%20environment">Print bash environment</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.5 Reverse Characters of Lines</h3>

<p>This script can be used to reverse the position of characters
in lines.  The technique moves two characters at a time, hence
it is faster than more intuitive implementations.

   <p>Note the <code>tx</code> command before the definition of the label. 
This is often needed to reset the flag that is tested by
the <code>t</code> command.

   <p>Imaginative readers will find uses for this script.  An example
is reversing the output of <code>banner</code>.<a rel="footnote" href="#fn-7"><sup>7</sup></a>

<pre class="example">     #!/usr/bin/sed -f
     
     /../! b
     
     # Reverse a line.  Begin embedding the line between two newlines
     s/^.*$/\
     &amp;\
     /
     
     # Move first character at the end.  The regexp matches until
     # there are zero or one characters between the markers
     tx
     :x
     s/\(\n.\)\(.*\)\(.\n\)/\3\2\1/
     tx
     
     # Remove the newline markers
     s/\n//g
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="tac">tac</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#cat%20-n">cat -n</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Reverse%20chars%20of%20lines">Reverse chars of lines</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.6 Reverse Lines of Files</h3>

<p>This one begins a series of totally useless (yet interesting)
scripts emulating various Unix commands.  This, in particular,
is a <code>tac</code> workalike.

   <p>Note that on implementations other than <small>GNU</small> <code>sed</code>
this script might easily overflow internal buffers.

<pre class="example">     #!/usr/bin/sed -nf
     
     # reverse all lines of input, i.e. first line became last, ...
     
     # from the second line, the buffer (which contains all previous lines)
     # is *appended* to current line, so, the order will be reversed
     1! G
     
     # on the last line we're done -- print everything
     $ p
     
     # store everything on the buffer again
     h
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="cat%20-n">cat -n</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#cat%20-b">cat -b</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#tac">tac</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.7 Numbering Lines</h3>

<p>This script replaces <code>cat -n</code>; in fact it formats its output
exactly like <small>GNU</small> <code>cat</code> does.

   <p>Of course this is completely useless and for two reasons:  first,
because somebody else did it in C, second, because the following
Bourne-shell script could be used for the same purpose and would
be much faster:

<pre class="example">     #! /bin/sh
     sed -e "=" $@ | sed -e '
       s/^/      /
       N
       s/^ *\(......\)\n/\1  /
     '
     </pre>

   <p>It uses <code>sed</code> to print the line number, then groups lines two
by two using <code>N</code>.  Of course, this script does not teach as much as
the one presented below.

   <p>The algorithm used for incrementing uses both buffers, so the line
is printed as soon as possible and then discarded.  The number
is split so that changing digits go in a buffer and unchanged ones go
in the other; the changed digits are modified in a single step
(using a <code>y</code> command).  The line number for the next line
is then composed and stored in the hold space, to be used in the
next iteration.

<pre class="example">     #!/usr/bin/sed -nf
     
     # Prime the pump on the first line
     x
     /^$/ s/^.*$/1/
     
     # Add the correct line number before the pattern
     G
     h
     
     # Format it and print it
     s/^/      /
     s/^ *\(......\)\n/\1  /p
     
     # Get the line number from hold space; add a zero
     # if we're going to add a digit on the next line
     g
     s/\n.*$//
     /^9*$/ s/^/0/
     
     # separate changing/unchanged digits with an x
     s/.9*$/x&amp;/
     
     # keep changing digits in hold space
     h
     s/^.*x//
     y/0123456789/1234567890/
     x
     
     # keep unchanged digits in pattern space
     s/x.*$//
     
     # compose the new number, remove the newline implicitly added by G
     G
     s/\n//
     h
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="cat%20-b">cat -b</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#wc%20-c">wc -c</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cat%20-n">cat -n</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.8 Numbering Non-blank Lines</h3>

<p>Emulating <code>cat -b</code> is almost the same as <code>cat -n</code>--we only
have to select which lines are to be numbered and which are not.

   <p>The part that is common to this script and the previous one is
not commented to show how important it is to comment <code>sed</code>
scripts properly...

<pre class="example">     #!/usr/bin/sed -nf
     
     /^$/ {
       p
       b
     }
     
     # Same as cat -n from now
     x
     /^$/ s/^.*$/1/
     G
     h
     s/^/      /
     s/^ *\(......\)\n/\1  /p
     x
     s/\n.*$//
     /^9*$/ s/^/0/
     s/.9*$/x&amp;/
     h
     s/^.*x//
     y/0123456789/1234567890/
     x
     s/x.*$//
     G
     s/\n//
     h
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="wc%20-c">wc -c</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#wc%20-w">wc -w</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cat%20-b">cat -b</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.9 Counting Characters</h3>

<p>This script shows another way to do arithmetic with <code>sed</code>. 
In this case we have to add possibly large numbers, so implementing
this by successive increments would not be feasible (and possibly
even more complicated to contrive than this script).

   <p>The approach is to map numbers to letters, kind of an abacus
implemented with <code>sed</code>.  <code>a</code>s are units, <code>b</code>s are
tenths and so on: we simply add the number of characters
on the current line as units, and then propagate the carry
to tenths, hundredths, and so on.

   <p>As usual, running totals are kept in hold space.

   <p>On the last line, we convert the abacus form back to decimal. 
For the sake of variety, this is done with a loop rather than
with some 80 <code>s</code> commands<a rel="footnote" href="#fn-8"><sup>8</sup></a>: first we
convert units, removing <code>a</code>s from the number; then we
rotate letters so that tenths become <code>a</code>s, and so on
until no more letters remain.

<pre class="example">     #!/usr/bin/sed -nf
     
     # Add n+1 a's to hold space (+1 is for the newline)
     s/./a/g
     H
     x
     s/\n/a/
     
     # Do the carry.  The t's and b's are not necessary,
     # but they do speed up the thing
     t a
     : a;  s/aaaaaaaaaa/b/g; t b; b done
     : b;  s/bbbbbbbbbb/c/g; t c; b done
     : c;  s/cccccccccc/d/g; t d; b done
     : d;  s/dddddddddd/e/g; t e; b done
     : e;  s/eeeeeeeeee/f/g; t f; b done
     : f;  s/ffffffffff/g/g; t g; b done
     : g;  s/gggggggggg/h/g; t h; b done
     : h;  s/hhhhhhhhhh//g
     
     : done
     $! {
       h
       b
     }
     
     # On the last line, convert back to decimal
     
     : loop
     /a/! s/[b-h]*/&amp;0/
     s/aaaaaaaaa/9/
     s/aaaaaaaa/8/
     s/aaaaaaa/7/
     s/aaaaaa/6/
     s/aaaaa/5/
     s/aaaa/4/
     s/aaa/3/
     s/aa/2/
     s/a/1/
     
     : next
     y/bcdefgh/abcdefg/
     /[a-h]/ b loop
     p
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="wc%20-w">wc -w</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#wc%20-l">wc -l</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#wc%20-c">wc -c</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.10 Counting Words</h3>

<p>This script is almost the same as the previous one, once each
of the words on the line is converted to a single <code>a</code>
(in the previous script each letter was changed to an <code>a</code>).

   <p>It is interesting that real <code>wc</code> programs have optimized
loops for <code>wc -c</code>, so they are much slower at counting
words rather than characters.  This script's bottleneck,
instead, is arithmetic, and hence the word-counting one
is faster (it has to manage smaller numbers).

   <p>Again, the common parts are not commented to show the importance
of commenting <code>sed</code> scripts.

<pre class="example">     #!/usr/bin/sed -nf
     
     # Convert words to a's
     s/[ <kbd>tab</kbd>][ <kbd>tab</kbd>]*/ /g
     s/^/ /
     s/ [^ ][^ ]*/a /g
     s/ //g
     
     # Append them to hold space
     H
     x
     s/\n//
     
     # From here on it is the same as in wc -c.
     /aaaaaaaaaa/! bx;   s/aaaaaaaaaa/b/g
     /bbbbbbbbbb/! bx;   s/bbbbbbbbbb/c/g
     /cccccccccc/! bx;   s/cccccccccc/d/g
     /dddddddddd/! bx;   s/dddddddddd/e/g
     /eeeeeeeeee/! bx;   s/eeeeeeeeee/f/g
     /ffffffffff/! bx;   s/ffffffffff/g/g
     /gggggggggg/! bx;   s/gggggggggg/h/g
     s/hhhhhhhhhh//g
     :x
     $! { h; b; }
     :y
     /a/! s/[b-h]*/&amp;0/
     s/aaaaaaaaa/9/
     s/aaaaaaaa/8/
     s/aaaaaaa/7/
     s/aaaaaa/6/
     s/aaaaa/5/
     s/aaaa/4/
     s/aaa/3/
     s/aa/2/
     s/a/1/
     y/bcdefgh/abcdefg/
     /[a-h]/ by
     p
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="wc%20-l">wc -l</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#head">head</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#wc%20-w">wc -w</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.11 Counting Lines</h3>

<p>No strange things are done now, because <code>sed</code> gives us
<code>wc -l</code> functionality for free!!! Look:

<pre class="example">     #!/usr/bin/sed -nf
     $=
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="head">head</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#tail">tail</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#wc%20-l">wc -l</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.12 Printing the First Lines</h3>

<p>This script is probably the simplest useful <code>sed</code> script. 
It displays the first 10 lines of input; the number of displayed
lines is right before the <code>q</code> command.

<pre class="example">     #!/usr/bin/sed -f
     10q
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="tail">tail</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#uniq">uniq</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#head">head</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.13 Printing the Last Lines</h3>

<p>Printing the last <var>n</var> lines rather than the first is more complex
but indeed possible.  <var>n</var> is encoded in the second line, before
the bang character.

   <p>This script is similar to the <code>tac</code> script in that it keeps the
final output in the hold space and prints it at the end:

<pre class="example">     #!/usr/bin/sed -nf
     
     1! {; H; g; }
     1,10 !s/[^\n]*\n//
     $p
     h
     </pre>

   <p>Mainly, the scripts keeps a window of 10 lines and slides it
by adding a line and deleting the oldest (the substitution command
on the second line works like a <code>D</code> command but does not
restart the loop).

   <p>The "sliding window" technique is a very powerful way to write
efficient and complex <code>sed</code> scripts, because commands like
<code>P</code> would require a lot of work if implemented manually.

   <p>To introduce the technique, which is fully demonstrated in the
rest of this chapter and is based on the <code>N</code>, <code>P</code>
and <code>D</code> commands, here is an implementation of <code>tail</code>
using a simple "sliding window."

   <p>This looks complicated but in fact the working is the same as
the last script: after we have kicked in the appropriate number
of lines, however, we stop using the hold space to keep inter-line
state, and instead use <code>N</code> and <code>D</code> to slide pattern
space by one line:

<pre class="example">     #!/usr/bin/sed -f
     
     1h
     2,10 {; H; g; }
     $q
     1,9d
     N
     D
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="uniq">uniq</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#uniq%20-d">uniq -d</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#tail">tail</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.14 Make Duplicate Lines Unique</h3>

<p>This is an example of the art of using the <code>N</code>, <code>P</code>
and <code>D</code> commands, probably the most difficult to master.

<pre class="example">     #!/usr/bin/sed -f
     h
     
     :b
     # On the last line, print and exit
     $b
     N
     /^\(.*\)\n\1$/ {
         # The two lines are identical.  Undo the effect of
         # the n command.
         g
         bb
     }
     
     # If the <code>N</code> command had added the last line, print and exit
     $b
     
     # The lines are different; print the first and go
     # back working on the second.
     P
     D
     </pre>

   <p>As you can see, we mantain a 2-line window using <code>P</code> and <code>D</code>. 
This technique is often used in advanced <code>sed</code> scripts.

<div class="node">
<p><hr>
Node:&nbsp;<a name="uniq%20-d">uniq -d</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#uniq%20-u">uniq -u</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#uniq">uniq</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.15 Print Duplicated Lines of Input</h3>

<p>This script prints only duplicated lines, like <code>uniq -d</code>.

<pre class="example">     #!/usr/bin/sed -nf
     
     $b
     N
     /^\(.*\)\n\1$/ {
         # Print the first of the duplicated lines
         s/.*\n//
         p
     
         # Loop until we get a different line
         :b
         $b
         N
         /^\(.*\)\n\1$/ {
             s/.*\n//
             bb
         }
     }
     
     # The last line cannot be followed by duplicates
     $b
     
     # Found a different one.  Leave it alone in the pattern space
     # and go back to the top, hunting its duplicates
     D
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="uniq%20-u">uniq -u</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#cat%20-s">cat -s</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#uniq%20-d">uniq -d</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.16 Remove All Duplicated Lines</h3>

<p>This script prints only unique lines, like <code>uniq -u</code>.

<pre class="example">     #!/usr/bin/sed -f
     
     # Search for a duplicate line --- until that, print what you find.
     $b
     N
     /^\(.*\)\n\1$/ ! {
         P
         D
     }
     
     :c
     # Got two equal lines in pattern space.  At the
     # end of the file we simply exit
     $d
     
     # Else, we keep reading lines with <code>N</code> until we
     # find a different one
     s/.*\n//
     N
     /^\(.*\)\n\1$/ {
         bc
     }
     
     # Remove the last instance of the duplicate line
     # and go back to the top
     D
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="cat%20-s">cat -s</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#uniq%20-u">uniq -u</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Examples">Examples</a>
<br>
</div>

<h3 class="section">4.17 Squeezing Blank Lines</h3>

<p>As a final example, here are three scripts, of increasing complexity
and speed, that implement the same function as <code>cat -s</code>, that is
squeezing blank lines.

   <p>The first leaves a blank line at the beginning and end if there are
some already.

<pre class="example">     #!/usr/bin/sed -f
     
     # on empty lines, join with next
     # Note there is a star in the regexp
     :x
     /^\n*$/ {
     N
     bx
     }
     
     # now, squeeze all '\n', this can be also done by:
     # s/^\(\n\)*/\1/
     s/\n*/\
     /
     </pre>

   <p>This one is a bit more complex and removes all empty lines
at the beginning.  It does leave a single blank line at end
if one was there.

<pre class="example">     #!/usr/bin/sed -f
     
     # delete all leading empty lines
     1,/^./{
     /./!d
     }
     
     # on an empty line we remove it and all the following
     # empty lines, but one
     :x
     /./!{
     N
     s/^\n$//
     tx
     }
     </pre>

   <p>This removes leading and trailing blank lines.  It is also the
fastest.  Note that loops are completely done with <code>n</code> and
<code>b</code>, without exploting the fact that <code>sed</code> cycles back
to the top of the script automatically at the end of a line.

<pre class="example">     #!/usr/bin/sed -nf
     
     # delete all (leading) blanks
     /./!d
     
     # get here: so there is a non empty
     :x
     # print it
     p
     # get next
     n
     # got chars? print it again, etc...
     /./bx
     
     # no, don't have chars: got an empty line
     :z
     # get next, if last line we finish here so no trailing
     # empty lines are written
     n
     # also empty? then ignore it, and get next... this will
     # remove ALL empty lines
     /./!bz
     
     # all empty lines were deleted/ignored, but we have a non empty.  As
     # what we want to do is to squeeze, insert a blank line artificially
     i\
     
     bx
     </pre>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Limitations">Limitations</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Other%20Resources">Other Resources</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Examples">Examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="chapter">5 <small>GNU</small> <code>sed</code>'s Limitations and Non-limitations</h2>

<p>For those who want to write portable <code>sed</code> scripts,
be aware that some implementations have been known to
limit line lengths (for the pattern and hold spaces)
to be no more than 4000 bytes. 
The <small>POSIX</small> standard specifies that conforming <code>sed</code>
implementations shall support at least 8192 byte line lengths. 
<small>GNU</small> <code>sed</code> has no built-in limit on line length;
as long as it can <code>malloc()</code> more (virtual) memory,
you can feed or construct lines as long as you like.

   <p>However, recursion is used to handle subpatterns and indefinite
repetition.  This means that the available stack space may limit
the size of the buffer that can be processed by certain patterns.

<div class="node">
<p><hr>
Node:&nbsp;<a name="Other%20Resources">Other Resources</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Reporting%20Bugs">Reporting Bugs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Limitations">Limitations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="chapter">6 Other Resources for Learning About <code>sed</code></h2>

<p>In addition to several books that have been written about <code>sed</code>
(either specifically or as chapters in books which discuss
shell programming), one can find out more about <code>sed</code>
(including suggestions of a few books) from the FAQ
for the <code>sed-users</code> mailing list, available from any of:
<pre class="display">      <a href="http://www.student.northpark.edu/pemente/sed/sedfaq.html">http://www.student.northpark.edu/pemente/sed/sedfaq.html</a>
      <a href="http://sed.sf.net/grabbag/tutorials/sedfaq.html">http://sed.sf.net/grabbag/tutorials/sedfaq.html</a>
     </pre>

   <p>Also of interest are
<a href="http://www.student.northpark.edu/pemente/sed/index.htm">http://www.student.northpark.edu/pemente/sed/index.htm</a>
and <a href="http://sed.sf.net/grabbag">http://sed.sf.net/grabbag</a>,
which include <code>sed</code> tutorials and other <code>sed</code>-related goodies.

   <p>The <code>sed-users</code> mailing list itself maintained by Sven Guckes. 
To subscribe, visit <a href="http://groups.yahoo.com">http://groups.yahoo.com</a> and search
for the <code>sed-users</code> mailing list.

<div class="node">
<p><hr>
Node:&nbsp;<a name="Reporting%20Bugs">Reporting Bugs</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Extended%20regexps">Extended regexps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Other%20Resources">Other Resources</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="chapter">7 Reporting Bugs</h2>

<p>Email bug reports to <a href="mailto:bonzini@gnu.org">bonzini@gnu.org</a>. 
Be sure to include the word "sed" somewhere in the <code>Subject:</code> field. 
Also, please include the output of <code>sed --version</code> in the body
of your report if at all possible.

   <p>Please do not send a bug report like this:

<pre class="example">     <i>while building frobme-1.3.4</i>
     $ configure
     error--&gt; sed: file sedscr line 1: Unknown option to 's'
     </pre>

   <p>If <small>GNU</small> <code>sed</code> doesn't configure your favorite package, take a
few extra minutes to identify the specific problem and make a stand-alone
test case.  Unlike other programs such as C compilers, making such test
cases for <code>sed</code> is quite simple.

   <p>A stand-alone test case includes all the data necessary to perform the
test, and the specific invocation of <code>sed</code> that causes the problem. 
The smaller a stand-alone test case is, the better.  A test case should
not involve something as far removed from <code>sed</code> as "try to configure
frobme-1.3.4".  Yes, that is in principle enough information to look
for the bug, but that is not a very practical prospect.

   <p>Here are a few commonly reported bugs that are not bugs.

     <dl>
<dt><code>sed -n</code> and <code>s/</code><var>regex</var><code>/replace/p</code>
     <dd>Some versions of <code>sed</code> ignore the <code>p</code> (print) option of an <code>s</code> command
unless the <code>-n</code> command-line option has been specified.  Other versions
always honor the <code>p</code> option. 
Both approaches are allowed by <small>POSIX</small>
and <small>GNU</small> <code>sed</code>
is the
better when you write complex scripts and also more intuitive, but
portable scripts should be written to work correctly with either
behavior.

     <br><dt><code>N</code> command on the last line
     <dd>

     <p>Most versions of <code>sed</code> exit without printing anything when
the <code>N</code> command is issued on the last line of a file. 
<small>GNU</small> <code>sed</code> prints pattern space before exiting unless of course
the <code>-n</code> command switch has been specified.  This choice is
by design.

     <p>For example, the behavior of
     <pre class="example">          sed N foo bar
          </pre>

     <p>would depend on whether foo has an even or an odd number of
lines<a rel="footnote" href="#fn-9"><sup>9</sup></a>.  Or, when writing a script to read the
next few lines following a pattern match, traditional
implementations of <code>sed</code> would force you to write
something like
     <pre class="example">          /foo/{ $!N; $!N; $!N; $!N; $!N; $!N; $!N; $!N; $!N }
          </pre>

     <p>instead of just
     <pre class="example">          /foo/{ N;N;N;N;N;N;N;N;N; }
          </pre>

     <p>In any case, the simplest workaround is to use <code>$d;N</code> in
scripts that rely on the traditional behavior, or to set
the <code>POSIXLY_CORRECT</code> variable to a non-empty value.

     <br><dt>Regex syntax clashes
     <dd><code>sed</code> uses the <small>POSIX</small> basic regular expression syntax.  According to
the standard, the meaning of some escape sequences is undefined in
this syntax;  notable in the case of <code>sed</code> are <code>\|</code>,
<code>\+</code>, <code>\?</code>, <code>\`</code>, <code>\'</code>, <code>\&lt;</code>,
<code>\&gt;</code>, <code>\b</code>, <code>\B</code>, <code>\w</code>, and <code>\W</code>.

     <p>As in all GNU programs that use <small>POSIX</small> basic regular expressions, <code>sed</code>
interprets these escape sequences as special characters.  So, <code>x\+</code>
matches one or more occurrences of <code>x</code>.  <code>abc\|def</code> matches
either <code>abc</code> or <code>def</code>.

     <p>This syntax may cause problems when running scripts written for other
<code>sed</code>s.  Some <code>sed</code> programs have been written with the
assumption that <code>\|</code> and <code>\+</code> match the literal characters
<code>|</code> and <code>+</code>.  Such scripts must be modified by removing the
spurious backslashes if they are to be used with modern implementations
of <code>sed</code>, like
<small>GNU</small> <code>sed</code>.

     <p>In addition, this version of <code>sed</code> supports several escape characters
(some of which are multi-character) to insert non-printable characters
in scripts (<code>\a</code>, <code>\c</code>, <code>\d</code>, <code>\o</code>, <code>\r</code>,
<code>\t</code>, <code>\v</code>, <code>\x</code>).  These can cause similar problems
with scripts written for other <code>sed</code>s.

     <br><dt><code>-i</code> clobbers read-only files
     <dd>

     <p>In short, <code>sed -i</code> will let you delete the contents of
a read-only file, and in general the <code>-i</code> option
(see <a href="#Invoking%20sed">Invocation</a>) lets you clobber
protected files.  This is not a bug, but rather a consequence
of how the Unix filesystem works.

     <p>The permissions on a file say what can happen to the data
in that file, while the permissions on a directory say what can
happen to the list of files in that directory.  <code>sed -i</code>
will not ever open for writing  a file that is already on disk. 
Rather, it will work on a temporary file that is finally renamed
to the original name: if you rename or delete files, you're actually
modifying the contents of the directory, so the operation depends on
the permissions of the directory, not of the file.  For this same
reason, <code>sed</code> does not let you use <code>-i</code> on a writeable file
in a read-only directory (but unbelievably nobody reports that as a
bug<small class="dots">...</small>). 
</dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Extended%20regexps">Extended regexps</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Concept%20Index">Concept Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Reporting%20Bugs">Reporting Bugs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="appendix">Appendix A Extended regular expressions</h2>

<p>The only difference between basic and extended regular expressions is in
the behavior of a few characters: <code>?</code>, <code>+</code>, parentheses,
and braces (<code>{}</code>).  While basic regular expressions require
these to be escaped if you want them to behave as special characters,
when using extended regular expressions you must escape them if
you want them <em>to match a literal character</em>.

<p>Examples:
     <dl>
<dt><code>abc?</code>
     <dd>becomes <code>abc\?</code> when using extended regular expressions.  It matches
the literal string <code>abc?</code>.

     <br><dt><code>c\+</code>
     <dd>becomes <code>c+</code> when using extended regular expressions.  It matches
one or more <code>c</code>s.

     <br><dt><code>a\{3,\}</code>
     <dd>becomes <code>a{3,}</code> when using extended regular expressions.  It matches
three or more <code>a</code>s.

     <br><dt><code>\(abc\)\{2,3\}</code>
     <dd>becomes <code>(abc){2,3}</code> when using extended regular expressions.  It
matches either <code>abcabc</code> or <code>abcabcabc</code>.

     <br><dt><code>\(abc*\)\1</code>
     <dd>becomes <code>(abc*)\1</code> when using extended regular expressions. 
Backreferences must still be escaped when using extended regular
expressions. 
</dl>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Concept%20Index">Concept Index</a>,
Next:&nbsp;<a rel="next" accesskey="n" href="#Command%20and%20Option%20Index">Command and Option Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Extended%20regexps">Extended regexps</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="unnumbered">Concept Index</h2>

<p>This is a general index of all issues discussed in this manual, with the
exception of the <code>sed</code> commands and command-line options.

<ul class="index-cp" compact>
<li>Additional reading about <code>sed</code>: <a href="#Other%20Resources">Other Resources</a>
<li><var>addr1</var>,+N: <a href="#Addresses">Addresses</a>
<li><var>addr1</var>,~N: <a href="#Addresses">Addresses</a>
<li>Address, as a regular expression: <a href="#Addresses">Addresses</a>
<li>Address, last line: <a href="#Addresses">Addresses</a>
<li>Address, numeric: <a href="#Addresses">Addresses</a>
<li>Addresses, in <code>sed</code> scripts: <a href="#Addresses">Addresses</a>
<li>Append hold space to pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Append next input line to pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Append pattern space to hold space: <a href="#Other%20Commands">Other Commands</a>
<li>Appending text after a line: <a href="#Other%20Commands">Other Commands</a>
<li>Backreferences, in regular expressions: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Branch to a label, if <code>s///</code> failed: <a href="#Extended%20Commands">Extended Commands</a>
<li>Branch to a label, if <code>s///</code> succeeded: <a href="#Programming%20Commands">Programming Commands</a>
<li>Branch to a label, unconditionally: <a href="#Programming%20Commands">Programming Commands</a>
<li>Buffer spaces, pattern and hold: <a href="#Data%20Spaces">Data Spaces</a>
<li>Bugs, reporting: <a href="#Reporting%20Bugs">Reporting Bugs</a>
<li>Case-insensitive matching: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Caveat -- #n on first line: <a href="#Common%20Commands">Common Commands</a>
<li>Command groups: <a href="#Common%20Commands">Common Commands</a>
<li>Comments, in scripts: <a href="#Common%20Commands">Common Commands</a>
<li>Conditional branch: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#Programming%20Commands">Programming Commands</a>
<li>Copy hold space into pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Copy pattern space into hold space: <a href="#Other%20Commands">Other Commands</a>
<li>Delete first line from pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Disabling autoprint, from command line: <a href="#Invoking%20sed">Invoking sed</a>
<li>empty regular expression: <a href="#Addresses">Addresses</a>
<li>Evaluate Bourne-shell commands: <a href="#Extended%20Commands">Extended Commands</a>
<li>Evaluate Bourne-shell commands, after substitution: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Exchange hold space with pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Excluding lines: <a href="#Addresses">Addresses</a>
<li>Extended regular expressions, choosing: <a href="#Invoking%20sed">Invoking sed</a>
<li>Extended regular expressions, syntax: <a href="#Extended%20regexps">Extended regexps</a>
<li>Files to be processed as input: <a href="#Invoking%20sed">Invoking sed</a>
<li>Flow of control in scripts: <a href="#Programming%20Commands">Programming Commands</a>
<li>Global substitution: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><small>GNU</small> extensions, <code>/dev/stderr</code> file: <a href="#Other%20Commands">Other Commands</a>, <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><small>GNU</small> extensions, <code>/dev/stdin</code> file: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#Other%20Commands">Other Commands</a>
<li><small>GNU</small> extensions, <code>/dev/stdout</code> file: <a href="#Other%20Commands">Other Commands</a>, <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><small>GNU</small> extensions, <code>0</code> address: <a href="#Addresses">Addresses</a>
<li><small>GNU</small> extensions, 0,<var>addr2</var> addressing: <a href="#Addresses">Addresses</a>
<li><small>GNU</small> extensions, <var>addr1</var>,+<var>N</var> addressing: <a href="#Addresses">Addresses</a>
<li><small>GNU</small> extensions, <var>addr1</var>,~<var>N</var> addressing: <a href="#Addresses">Addresses</a>
<li><small>GNU</small> extensions, branch if <code>s///</code> failed: <a href="#Extended%20Commands">Extended Commands</a>
<li><small>GNU</small> extensions, case modifiers in <code>s</code> commands: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><small>GNU</small> extensions, checking for their presence: <a href="#Extended%20Commands">Extended Commands</a>
<li><small>GNU</small> extensions, evaluating Bourne-shell commands: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><small>GNU</small> extensions, extended regular expressions: <a href="#Invoking%20sed">Invoking sed</a>
<li><small>GNU</small> extensions, <code>g</code> and <var>number</var> modifier interaction in <code>s</code> command: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><small>GNU</small> extensions, <code>I</code> modifier: <a href="#The%20%22s%22%20Command">The "s" Command</a>, <a href="#Addresses">Addresses</a>
<li><small>GNU</small> extensions, in-place editing: <a href="#Reporting%20Bugs">Reporting Bugs</a>, <a href="#Invoking%20sed">Invoking sed</a>
<li><small>GNU</small> extensions, <code>L</code> command: <a href="#Extended%20Commands">Extended Commands</a>
<li><small>GNU</small> extensions, <code>M</code> modifier: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><small>GNU</small> extensions, modifiers and the empty regular expression: <a href="#Addresses">Addresses</a>
<li><small>GNU</small> extensions, <code></code><var>n</var><code>~</code><var>m</var><code></code> addresses: <a href="#Addresses">Addresses</a>
<li><small>GNU</small> extensions, quitting silently: <a href="#Extended%20Commands">Extended Commands</a>
<li><small>GNU</small> extensions, <code>R</code> command: <a href="#Extended%20Commands">Extended Commands</a>
<li><small>GNU</small> extensions, reading a file a line at a time: <a href="#Extended%20Commands">Extended Commands</a>
<li><small>GNU</small> extensions, reformatting paragraphs: <a href="#Extended%20Commands">Extended Commands</a>
<li><small>GNU</small> extensions, returning an exit code: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#Common%20Commands">Common Commands</a>
<li><small>GNU</small> extensions, setting line length: <a href="#Other%20Commands">Other Commands</a>
<li><small>GNU</small> extensions, special escapes: <a href="#Reporting%20Bugs">Reporting Bugs</a>, <a href="#Escapes">Escapes</a>
<li><small>GNU</small> extensions, special two-address forms: <a href="#Addresses">Addresses</a>
<li><small>GNU</small> extensions, subprocesses: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><small>GNU</small> extensions, to basic regular expressions: <a href="#Reporting%20Bugs">Reporting Bugs</a>, <a href="#Regular%20Expressions">Regular Expressions</a>
<li><small>GNU</small> extensions, unlimited line length: <a href="#Limitations">Limitations</a>
<li><small>GNU</small> extensions, writing first line to a file: <a href="#Extended%20Commands">Extended Commands</a>
<li>Goto, in scripts: <a href="#Programming%20Commands">Programming Commands</a>
<li>Greedy regular expression matching: <a href="#Regular%20Expressions">Regular Expressions</a>
<li>Grouping commands: <a href="#Common%20Commands">Common Commands</a>
<li>Hold space, appending from pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Hold space, appending to pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Hold space, copy into pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Hold space, copying pattern space into: <a href="#Other%20Commands">Other Commands</a>
<li>Hold space, definition: <a href="#Data%20Spaces">Data Spaces</a>
<li>Hold space, exchange with pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>In-place editing: <a href="#Reporting%20Bugs">Reporting Bugs</a>, <a href="#Invoking%20sed">Invoking sed</a>
<li>Inserting text before a line: <a href="#Other%20Commands">Other Commands</a>
<li>Labels, in scripts: <a href="#Programming%20Commands">Programming Commands</a>
<li>Last line, selecting: <a href="#Addresses">Addresses</a>
<li>Line length, setting: <a href="#Other%20Commands">Other Commands</a>, <a href="#Invoking%20sed">Invoking sed</a>
<li>Line number, printing: <a href="#Other%20Commands">Other Commands</a>
<li>Line selection: <a href="#Addresses">Addresses</a>
<li>Line, selecting by number: <a href="#Addresses">Addresses</a>
<li>Line, selecting by regular expression match: <a href="#Addresses">Addresses</a>
<li>Line, selecting last: <a href="#Addresses">Addresses</a>
<li>List pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Mixing <code>g</code> and <var>number</var> modifiers in the <code>s</code> command: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Next input line, append to pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Next input line, replace pattern space with: <a href="#Common%20Commands">Common Commands</a>
<li>Non-bugs, in-place editing: <a href="#Reporting%20Bugs">Reporting Bugs</a>
<li>Non-bugs, <code>N</code> command on the last line: <a href="#Reporting%20Bugs">Reporting Bugs</a>
<li>Non-bugs, <code>p</code> command and <code>-n</code> flag: <a href="#Reporting%20Bugs">Reporting Bugs</a>, <a href="#Common%20Commands">Common Commands</a>
<li>Non-bugs, regex syntax clashes: <a href="#Reporting%20Bugs">Reporting Bugs</a>
<li>Parenthesized substrings: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Pattern space, definition: <a href="#Data%20Spaces">Data Spaces</a>
<li>Perl-style regular expressions, multiline: <a href="#Addresses">Addresses</a>
<li>Portability, comments: <a href="#Common%20Commands">Common Commands</a>
<li>Portability, line length limitations: <a href="#Limitations">Limitations</a>
<li>Portability, <code>N</code> command on the last line: <a href="#Reporting%20Bugs">Reporting Bugs</a>
<li>Portability, <code>p</code> command and <code>-n</code> flag: <a href="#Reporting%20Bugs">Reporting Bugs</a>, <a href="#Common%20Commands">Common Commands</a>
<li><code>POSIXLY_CORRECT</code> behavior, bracket expressions: <a href="#Regular%20Expressions">Regular Expressions</a>
<li><code>POSIXLY_CORRECT</code> behavior, empty regular expression: <a href="#Addresses">Addresses</a>
<li><code>POSIXLY_CORRECT</code> behavior, escapes: <a href="#Escapes">Escapes</a>
<li><code>POSIXLY_CORRECT</code> behavior, <code>N</code> command: <a href="#Reporting%20Bugs">Reporting Bugs</a>
<li><code>POSIXLY_CORRECT</code> behavior, two addresses: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#Other%20Commands">Other Commands</a>
<li>Print first line from pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Printing line number: <a href="#Other%20Commands">Other Commands</a>
<li>Printing text unambiguously: <a href="#Other%20Commands">Other Commands</a>
<li>Quitting: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#Common%20Commands">Common Commands</a>
<li>Range of lines: <a href="#Addresses">Addresses</a>
<li>Range with start address of zero: <a href="#Addresses">Addresses</a>
<li>Read next input line: <a href="#Common%20Commands">Common Commands</a>
<li>Read text from a file: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#Other%20Commands">Other Commands</a>
<li>Reformat pattern space: <a href="#Extended%20Commands">Extended Commands</a>
<li>Reformatting paragraphs: <a href="#Extended%20Commands">Extended Commands</a>
<li>Replace hold space with copy of pattern space: <a href="#Other%20Commands">Other Commands</a>
<li>Replace pattern space with copy of hold space: <a href="#Other%20Commands">Other Commands</a>
<li>Replacing all text matching regexp in a line: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Replacing only <var>n</var>th match of regexp in a line: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Replacing selected lines with other text: <a href="#Other%20Commands">Other Commands</a>
<li>Requiring <small>GNU</small> <code>sed</code>: <a href="#Extended%20Commands">Extended Commands</a>
<li>Script structure: <a href="#sed%20Programs">sed Programs</a>
<li>Script, from a file: <a href="#Invoking%20sed">Invoking sed</a>
<li>Script, from command line: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>sed</code> program structure: <a href="#sed%20Programs">sed Programs</a>
<li>Selecting lines to process: <a href="#Addresses">Addresses</a>
<li>Selecting non-matching lines: <a href="#Addresses">Addresses</a>
<li>Several lines, selecting: <a href="#Addresses">Addresses</a>
<li>Slash character, in regular expressions: <a href="#Addresses">Addresses</a>
<li>Spaces, pattern and hold: <a href="#Data%20Spaces">Data Spaces</a>
<li>Special addressing forms: <a href="#Addresses">Addresses</a>
<li>Standard input, processing as input: <a href="#Invoking%20sed">Invoking sed</a>
<li>Stream editor: <a href="#Introduction">Introduction</a>
<li>Subprocesses: <a href="#Extended%20Commands">Extended Commands</a>, <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Substitution of text, options: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Text, appending: <a href="#Other%20Commands">Other Commands</a>
<li>Text, deleting: <a href="#Common%20Commands">Common Commands</a>
<li>Text, insertion: <a href="#Other%20Commands">Other Commands</a>
<li>Text, printing: <a href="#Common%20Commands">Common Commands</a>
<li>Text, printing after substitution: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Text, writing to a file after substitution: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li>Transliteration: <a href="#Other%20Commands">Other Commands</a>
<li>Unbuffered I/O, choosing: <a href="#Invoking%20sed">Invoking sed</a>
<li>Usage summary, printing: <a href="#Invoking%20sed">Invoking sed</a>
<li>Version, printing: <a href="#Invoking%20sed">Invoking sed</a>
<li>Working on separate files: <a href="#Invoking%20sed">Invoking sed</a>
<li>Write first line to a file: <a href="#Extended%20Commands">Extended Commands</a>
<li>Write to a file: <a href="#Other%20Commands">Other Commands</a>
<li>Zero, as range start address: <a href="#Addresses">Addresses</a>
   </ul>

<div class="node">
<p><hr>
Node:&nbsp;<a name="Command%20and%20Option%20Index">Command and Option Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Concept%20Index">Concept Index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>
<br>
</div>

<h2 class="unnumbered">Command and Option Index</h2>

<p>This is an alphabetical list of all <code>sed</code> commands and command-line
options.

<ul class="index-fn" compact>
<li><code># (comments)</code>: <a href="#Common%20Commands">Common Commands</a>
<li><code>--expression</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--file</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--help</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--in-place</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--line-length</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--quiet</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--regexp-extended</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--silent</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--unbuffered</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>--version</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-e</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-f</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-h</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-i</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-l</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-n</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-n, forcing from within a script</code>: <a href="#Common%20Commands">Common Commands</a>
<li><code>-r</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-u</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>-V</code>: <a href="#Invoking%20sed">Invoking sed</a>
<li><code>: (label) command</code>: <a href="#Programming%20Commands">Programming Commands</a>
<li><code>= (print line number) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>a (append text lines) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>b (branch) command</code>: <a href="#Programming%20Commands">Programming Commands</a>
<li><code>c (change to text lines) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>D (delete first line) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>d (delete) command</code>: <a href="#Common%20Commands">Common Commands</a>
<li><code>e (evaluate) command</code>: <a href="#Extended%20Commands">Extended Commands</a>
<li><code>G (appending Get) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>g (get) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>H (append Hold) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>h (hold) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>i (insert text lines) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>L (fLow paragraphs) command</code>: <a href="#Extended%20Commands">Extended Commands</a>
<li><code>l (list unambiguously) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>N (append Next line) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>n (next-line) command</code>: <a href="#Common%20Commands">Common Commands</a>
<li><code>P (print first line) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>p (print) command</code>: <a href="#Common%20Commands">Common Commands</a>
<li><code>q (quit) command</code>: <a href="#Common%20Commands">Common Commands</a>
<li><code>Q (silent Quit) command</code>: <a href="#Extended%20Commands">Extended Commands</a>
<li><code>r (read file) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>R (read line) command</code>: <a href="#Extended%20Commands">Extended Commands</a>
<li><code>s command, option flags</code>: <a href="#The%20%22s%22%20Command">The "s" Command</a>
<li><code>T (test and branch if failed) command</code>: <a href="#Extended%20Commands">Extended Commands</a>
<li><code>t (test and branch if successful) command</code>: <a href="#Programming%20Commands">Programming Commands</a>
<li><code>v (version) command</code>: <a href="#Extended%20Commands">Extended Commands</a>
<li><code>w (write file) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>W (write first line) command</code>: <a href="#Extended%20Commands">Extended Commands</a>
<li><code>x (eXchange) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>y (transliterate) command</code>: <a href="#Other%20Commands">Other Commands</a>
<li><code>{} command grouping</code>: <a href="#Common%20Commands">Common Commands</a>
   </ul>

<div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top"></a>
<li><a name="toc_Introduction" href="#Introduction">1 Introduction</a>
<li><a name="toc_Invoking%20sed" href="#Invoking%20sed">2 Invocation</a>
<li><a name="toc_sed%20Programs" href="#sed%20Programs">3 <code>sed</code> Programs</a>
<ul>
<li><a href="#Addresses">3.1 Selecting lines with <code>sed</code></a>
<li><a href="#Regular%20Expressions">3.2 Overview of Regular Expression Syntax</a>
<li><a href="#Data%20Spaces">3.3 Where <code>sed</code> Buffers Data</a>
<li><a href="#Common%20Commands">3.4 Often-Used Commands</a>
<li><a href="#The%20%22s%22%20Command">3.5 The <code>s</code> Command</a>
<li><a href="#Other%20Commands">3.6 Less Frequently-Used Commands</a>
<li><a href="#Programming%20Commands">3.7 Commands for <code>sed</code> gurus</a>
<li><a href="#Extended%20Commands">3.8 Commands Specific to <small>GNU</small> <code>sed</code></a>
<li><a href="#Escapes">3.9 <small>GNU</small> Extensions for Escapes in Regular Expressions</a>
</li></ul>
<li><a name="toc_Examples" href="#Examples">4 Some Sample Scripts</a>
<ul>
<li><a href="#Centering%20lines">4.1 Centering Lines</a>
<li><a href="#Increment%20a%20number">4.2 Increment a Number</a>
<li><a href="#Rename%20files%20to%20lower%20case">4.3 Rename Files to Lower Case</a>
<li><a href="#Print%20bash%20environment">4.4 Print <code>bash</code> Environment</a>
<li><a href="#Reverse%20chars%20of%20lines">4.5 Reverse Characters of Lines</a>
<li><a href="#tac">4.6 Reverse Lines of Files</a>
<li><a href="#cat%20-n">4.7 Numbering Lines</a>
<li><a href="#cat%20-b">4.8 Numbering Non-blank Lines</a>
<li><a href="#wc%20-c">4.9 Counting Characters</a>
<li><a href="#wc%20-w">4.10 Counting Words</a>
<li><a href="#wc%20-l">4.11 Counting Lines</a>
<li><a href="#head">4.12 Printing the First Lines</a>
<li><a href="#tail">4.13 Printing the Last Lines</a>
<li><a href="#uniq">4.14 Make Duplicate Lines Unique</a>
<li><a href="#uniq%20-d">4.15 Print Duplicated Lines of Input</a>
<li><a href="#uniq%20-u">4.16 Remove All Duplicated Lines</a>
<li><a href="#cat%20-s">4.17 Squeezing Blank Lines</a>
</li></ul>
<li><a name="toc_Limitations" href="#Limitations">5 <small>GNU</small> <code>sed</code>'s Limitations and Non-limitations</a>
<li><a name="toc_Other%20Resources" href="#Other%20Resources">6 Other Resources for Learning About <code>sed</code></a>
<li><a name="toc_Reporting%20Bugs" href="#Reporting%20Bugs">7 Reporting Bugs</a>
<li><a name="toc_Extended%20regexps" href="#Extended%20regexps">Appendix A Extended regular expressions</a>
<li><a name="toc_Concept%20Index" href="#Concept%20Index">Concept Index</a>
<li><a name="toc_Command%20and%20Option%20Index" href="#Command%20and%20Option%20Index">Command and Option Index</a>
</li></ul>
</div>


   <div class="footnote">
<hr>
<h4>Footnotes</h4>
<ol type="1">
<li><a name="fn-1"></a>
<p>This applies to commands such as <code>=</code>,
<code>a</code>, <code>c</code>, <code>i</code>, <code>l</code>, <code>p</code>.  You can
still write to the standard output by using the <code>w</code>
or <code>W</code> commands together with the <code>/dev/stdout</code>
special file</p>

   <li><a name="fn-2"></a>
<p>Note that <small>GNU</small> <code>sed</code>
    creates the backup file whether
    or not any output is actually changed.</p>

   <li><a name="fn-3"></a>
<p>This is equivalent to <code>p</code> unless the <code>-i</code>
option is being used.</p>

   <li><a name="fn-4"></a>
<p>This is equivalent to <code>p</code> unless the <code>-i</code>
option is being used.</p>

   <li><a name="fn-5"></a>
<p>All
the escapes introduced here are <small>GNU</small>
extensions, with the exception of <code>\n</code>.</p>

   <li><a name="fn-6"></a>
<p><code>sed</code> guru Greg
Ubben wrote an implementation of the <code>dc</code> <small>RPN</small> calculator! 
It is distributed together with sed.</p>

   <li><a name="fn-7"></a>
<p>This requires
another script to pad the output of banner; for example

<pre class="example">     #! /bin/sh
     
     banner -w $1 $2 $3 $4 |
       sed -e :a -e '/^.\{0,'$1'\}$/ { s/$/ /; ba; }' |
       ~/sedscripts/reverseline.sed
     </pre>
   </p>

   <li><a name="fn-8"></a>
<p>Some implementations
have a limit of 199 commands per script</p>

   <li><a name="fn-9"></a>
<p>which is the actual "bug" that prompted the
change in behavior</p>

   </ol><hr></div>

   </body></html>

